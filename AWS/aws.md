# AWS

## 고가용성, 내결함성

- 고가용성 : 전체 시스템에 대하여, 사람이 개입하지 않아도 시스템이 항상 작동하고 액세스 가능, 가동 중지를 최소화하도록 보장하는 것

  - 시스템을 1분이라도 사용할 수 없으면 비즈니스에 중대한 손상
  - ELB : 지연 시간이 길거나 서버가 과다 사용되는 경우 이를 알리는 트리거로 동작
  - EIP : 인스턴스가 실패하더라도 클라이언트가 애플리케이션에 액세스할 수 있도록 고정 IP
  - Route 53 : 단순 라우팅, 지연 시간에 따른 라우팅, 상태확인, DNS 장애 조치, 지리 위치 라우팅 지원
  - Auto Scaling
  - CloudWatch
  - 여러 AZ

- 내결함성 : 시스템의 일부 구성요소에 장애가 있어도 시스템이 계속 작동할 수 있는 기능 (애플리케이션 관점)

  - SQS : 내결함성 애플리케이션의 백본으로 사용, 안정적인 분산 메시징 시스템, 대기열 항시 사용 가능
  - S3 : 내구성과 결함성이 뛰어난 데이터 스토리지. 리전 내 여러 시설에서 각 디바이스의 모든 데이터를 중복 저장
  - RDS : 자동 백업, 스냅샷, 여러 가용 역역 지점

- 탄력성 : 용량 요구사항에 대해 신경쓰지 않고 자동화된 확장 및 축소
  - 트래픽 급증 시 웹 서버 수 증가
  - 트래픽이 줄어들 때 데이터베이스 쓰기 용량 감소 (IOPS : Input/Output Opereations Per Second)
  - 아키텍쳐 전반에 걸친 일상적인 수요 변동 처리
  - 시간 기반 탄력성 : 리소스가 사용되지 않을 때 리소스 끄기
  - 볼륨 기반 탄력성 : 수용 강도에 맞게 규모 조정

## 재해 복구 (DR)

- 복구 시간 목표(RTO) : 시스템이 오류를 복구하는 데 걸리는 시간. 시스템 중단 후 서비스를 다시 제공하기까지의 시간
- 복구 지점 목표(RPO) : 오류 발생 시 수용할 수 있는 데이터 손실 시간.

- 단일 가상 서버에 대한 고가용성 비교

|                          | RTO     | RPO                                                                | 가용성                                                  |
| ------------------------ | ------- | ------------------------------------------------------------------ | ------------------------------------------------------- |
| CloudWatch 트리거로 복구 | 약 10분 | 데이터 손실 없음                                                   | 가상 서버의 오류는 복구, 전체 AZ의 장애로부터 복구 불가 |
| Auto Scaling으로 복구    | 약 10분 | 마지막 스냅샷 이후 모든 데이터 손실. 스냅샷 실행간격은 30분~24시간 | 가상 서버의 오류도 복구, 전체 AZ의 장애로부터 복구      |

### Multi-Region 전략

1. 백업 및 복원
   - 수시간 RPO / 24시간 이내 RTO
2. Pilot Light
   - 수분 RPO / 수시간 RTO
   - 데이터베이스는 on / 서버는 off -> DR 시에만 사용됨 (ex> 스냅샷)
3. Warm Standby
   - 수초 RPO / 수분 RTO
   - 완전하게 대기하고 있는 인스턴스로 교체
   - 대기 인스턴스에 대해서 성립하는 RTO/RPO이며, DB에서 읽기전용 복제본을 마스터로 승격시키는 경우, 이를 자동으로 구성하는 방법은 없기 때문에 목표 RTO/RPO를 충족할 수 없음
4. Active-Active
   - RPO는 0에 가까움 / RTO는 0일 수 있음
   - 여러 리전에 배포되어 트래픽 처리

## Support Case with APN

- 고객사가 요청한 내용에 대해서 Support Case를 열어 AWS 상에 문의를 해야하는 경우가 있다. 그런 경우에 Support Plan을 가입해야 한다.
- Basic plan의 경우 Support Case를 열 수 없게 되어 있고, Developer plan의 경우 현지 업무 시간에 이메일만 가능하고 응답시간이 최대 12시간까지 이기 때문에, 최소 Business Plan으로 잠시 변경해야 한다.
- 해당 경우에 AWS 월 사용료에 따라 추가적인 과금이 생길 수 있다.

### 심각도(Severity)

- General guidance : 1일 응답 시간
- System impaired : 12시간 응답 시간
- Production system impaired : 4시간 응답 시간 (Business Support Plan)
- Production system down : 1시간 응답 시간 (Business Support Plan)
- Business-critial system down : 15분 응답 시간 (Enterprise Support Plan)
